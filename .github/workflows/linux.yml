name: Linux CI

on: [push, pull_request]

jobs:
  build:

    runs-on: ubuntu-22.04

    steps:
    - uses: actions/checkout@v2
    - name: install-packages
      run: |
        sudo apt-get update
        sudo apt-get install build-essential libbz2-dev libfftw3-dev libfishsound1-dev libid3tag0-dev liblo-dev liblrdf0-dev libmad0-dev liboggz2-dev libopus-dev libopusfile-dev libpulse-dev libsamplerate-dev libsndfile-dev libsord-dev libxml2-utils portaudio19-dev qtbase5-dev libqt5svg5-dev qtpdf5-dev raptor2-utils git mercurial autoconf automake libtool smlnj capnproto libcapnp-dev meson ninja-build
    - name: install-rubberband
      run: |
        mkdir -p tmp/rubberband
        cd tmp/rubberband
        wget https://breakfastquay.com/files/releases/rubberband-3.3.0.tar.bz2
        tar xvjf rubberband-3.3.0.tar.bz2
        cd rubberband-3.3.0
        meson setup build && ninja -C build && sudo ninja -C build install
    - name: repoint
      run: ./repoint install
    - name: configure
      run: meson setup build --buildtype release
    - name: make
      run: ninja -C build
    - name: test
      run: meson test -C build
